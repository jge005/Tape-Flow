<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Tape Manager</title>

<style>
body{
  font-family: Pretendard, sans-serif;
  background:#f5f7ff;
  margin:0;
  padding:0;
}

.nav{
  display:flex;
  gap:10px;
  padding:15px;
}

.nav button{
  padding:10px 16px;
  border:none;
  border-radius:12px;
  background:#d9dffe;
  color:#333;
  font-size:16px;
}

.nav button.active{
  background:#5665ff;
  color:#fff;
}

.app-title{
  font-size:28px;
  padding:20px;
  font-weight:800;
  display:flex;
  align-items:center;
  gap:10px;
}

.page{
  display:none;
  padding:20px;
}

.page.active{
  display:block;
}

input, select{
  width:100%;
  padding:12px;
  border:1px solid #ccc;
  border-radius:10px;
  margin-bottom:10px;
}

button.add{
  background:#5665ff;
  color:white;
  padding:12px 16px;
  border:none;
  border-radius:10px;
  margin-top:10px;
}

.table-box{
  width:100%;
  background:white;
  border-radius:12px;
  padding:10px;
  margin-top:15px;
}

table{
  width:100%;
  border-collapse:collapse;
}

th,td{
  border-bottom:1px solid #eee;
  padding:8px;
  font-size:14px;
}

.summary-card{
  background:white;
  padding:15px;
  border-radius:12px;
  margin-bottom:12px;
  box-shadow:0 2px 4px rgba(0,0,0,0.08);
}

</style>
</head>

<body>

<div class="app-title">π“¦ Tape Manager</div>

<div class="nav">
  <button id="nav-tape" class="active">ν…μ΄ν”„ μ„¤μ •</button>
  <button id="nav-stock">μ‘μ—…μ „ μ¬κ³ </button>
  <button id="nav-work">μ‘μ—… λ“±λ΅</button>
  <button id="nav-summary">μ”λ‰</button>
</div>

<!-- ======================== ν…μ΄ν”„ μ„¤μ • ============================= -->
<div class="page active" id="page-tape">

  <label>ν…μ΄ν”„λ…</label>
  <input id="tapeName" placeholder="μ: 25*6000">

  <label>EA(μ ν’ μλ‰)/1μ¥λ‹Ή</label>
  <input id="eaPerSheet" placeholder="μ: 6">

  <label>μ¶μ²</label>
  <select id="tapeSource">
    <option value="κ°€κ³µμ‹¤">κ°€κ³µμ‹¤</option>
    <option value="νƒμ„±">νƒμ„±</option>
  </select>

  <button class="add" onclick="addTape()">μ¶”κ°€</button>

  <div id="tapeList" class="table-box"></div>

</div>


<!-- ======================== μ‘μ—…μ „ μ¬κ³  ============================= -->
<div class="page" id="page-stock">

  <label>μ ν’λ…</label>
  <input id="stockName" placeholder="μ: 7125J">

  <label>μλ‰(EA)</label>
  <input id="stockEa" type="number" placeholder="μ: 2520">

  <label>μ„ΈνΈ κµ¬λ¶„</label>
  <input id="stockLot" placeholder="LOT / λΉ„κ³  λ“±">

  <button class="add" onclick="addStock()">μ¶”κ°€</button>

  <div id="stockList" class="table-box"></div>

</div>


<!-- ======================== μ‘μ—… λ“±λ΅ ============================= -->
<div class="page" id="page-work">

  <label>μ ν’λ…</label>
  <input id="workName">

  <label>μ‚¬μ© ν…μ΄ν”„</label>
  <select id="workTape"></select>

  <label>μ‚¬μ© EA</label>
  <input id="workEa" type="number" placeholder="μ…λ ¥ μ‹ ν…μ΄ν”„μ¥μ μλ™ κ³„μ‚°">

  <label>ν…μ΄ν”„ μ¥μ</label>
  <input id="workSheets" type="number" placeholder="μ…λ ¥ μ‹ EA μλ™ κ³„μ‚°">

  <label>λ¶λ‰(μ¥)</label>
  <input id="workBad" type="number" value="0">

  <button class="add" onclick="addWork()">λ“±λ΅</button>

  <div id="workList" class="table-box"></div>

</div>


<!-- ======================== μ”λ‰ ============================= -->
<div class="page" id="page-summary">
  <div id="summaryArea"></div>
</div>



<script>
// ======================= μ €μ¥κ³µκ°„ =======================
let tapes = JSON.parse(localStorage.getItem("tapes") || "[]");
let stocks = JSON.parse(localStorage.getItem("stocks") || "[]");
let works = JSON.parse(localStorage.getItem("works") || "[]");

function save(){
  localStorage.setItem("tapes", JSON.stringify(tapes));
  localStorage.setItem("stocks", JSON.stringify(stocks));
  localStorage.setItem("works", JSON.stringify(works));
}


// ======================= νμ΄μ§€ μ „ν™ =======================
function openPage(id){
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.getElementById("page-"+id).classList.add("active");

  document.querySelectorAll(".nav button").forEach(b=>b.classList.remove("active"));
  document.getElementById("nav-"+id).classList.add("active");

  if(id==="summary") renderSummary();
  if(id==="work") refreshWorkTapeList();
}

document.getElementById("nav-tape").addEventListener("click",()=>openPage("tape"));
document.getElementById("nav-stock").addEventListener("click",()=>openPage("stock"));
document.getElementById("nav-work").addEventListener("click",()=>openPage("work"));
document.getElementById("nav-summary").addEventListener("click",()=>openPage("summary"));


// ======================= ν…μ΄ν”„ μ„¤μ • =======================
function addTape(){
  let name = tapeName.value.trim();
  let ea = Number(eaPerSheet.value);
  let src = tapeSource.value;

  if(!name || !ea){ alert("μ…λ ¥ λ¶€μ΅±"); return; }

  tapes.push({name, ea, src});
  save();
  renderTapeList();

  tapeName.value="";
  eaPerSheet.value="";
}

function renderTapeList(){
  let html = `<table><tr><th>ν…μ΄ν”„</th><th>EA/μ¥</th><th>μ¶μ²</th></tr>`;
  tapes.forEach(t=>{
    html += `<tr><td>${t.name}</td><td>${t.ea}</td><td>${t.src}</td></tr>`;
  });
  html += `</table>`;
  tapeList.innerHTML = html;
}
renderTapeList();

function refreshWorkTapeList(){
  workTape.innerHTML = tapes.map(t=>`<option>${t.name}</option>`).join("");
}


// ======================= μ‘μ—…μ „ μ¬κ³  =======================
function addStock(){
  let name = stockName.value.trim();
  let ea = Number(stockEa.value);
  let lot = stockLot.value.trim();

  if(!name || !ea){ alert("μ…λ ¥ λ¶€μ΅±"); return; }

  stocks.push({name, ea, lot});
  save();
  renderStockList();

  stockName.value="";
  stockEa.value="";
  stockLot.value="";
}

function renderStockList(){
  let html = `<table><tr><th>μ ν’λ…</th><th>EA</th><th>LOT</th></tr>`;
  stocks.forEach(s=>{
    html+=`<tr><td>${s.name}</td><td>${s.ea}</td><td>${s.lot}</td></tr>`;
  });
  html+=`</table>`;
  stockList.innerHTML = html;
}
renderStockList();


// ======================= μ‘μ—… λ“±λ΅ =======================
function addWork(){
  let name = workName.value.trim();
  let tape = workTape.value;
  let ea = Number(workEa.value);
  let sheet = Number(workSheets.value);
  let bad = Number(workBad.value || 0);

  let tapeObj = tapes.find(t=>t.name===tape);
  if(!name || !tapeObj) return alert("μ…λ ¥ μ¤λ¥");

  // λ‘ μ¤‘ ν•λ‚λ§ μ…λ ¥ν•΄λ„ μλ™κ³„μ‚°
  if(ea && !sheet) sheet = Math.ceil(ea / tapeObj.ea);
  else if(sheet && !ea) ea = sheet * tapeObj.ea;

  works.push({name, tape, ea, sheet, bad});
  save();
  renderWorkList();

  workName.value="";
  workEa.value="";
  workSheets.value="";
  workBad.value="0";
}

function renderWorkList(){
  let html = `<table><tr><th>μ ν’λ…</th><th>EA</th><th>μ¥μ</th><th>λ¶λ‰</th></tr>`;
  works.forEach(w=>{
    html+=`<tr><td>${w.name}</td><td>${w.ea}</td><td>${w.sheet}</td><td>${w.bad}</td></tr>`;
  });
  html+=`</table>`;
  workList.innerHTML = html;
}
renderWorkList();


// ======================= μ”λ‰ =======================
function renderSummary(){
  let area = "";

  tapes.forEach(t=>{
    let inStock = 0;
    let used = 0;
    let bad = 0;

    // μ‘μ—…μ „ μ¬κ³ λ” "EA λ‹¨μ„" μ΄λ―€λ΅ ν…μ΄ν”„ μ‚¬μ©λ‰κ³Ό μ§μ ‘ κ΄€κ³„ μ—†μ

    // μ‹¤μ  ν…μ΄ν”„ μ‚¬μ©λ‰
    works.forEach(w=>{
      if(w.tape === t.name){
        used += w.sheet;
        bad += w.bad;
      }
    });

    area += `
      <div class="summary-card">
        <b>${t.name}</b><br>
        β€Ά μ΄ μ‚¬μ© μ¥μ: ${used}<br>
        β€Ά λ¶λ‰ μ¥μ: ${bad}<br>
        <small>(ν„μ¬ μ”λ‰μ€ ν…μ΄ν”„ μ…κ³  κΈ°λ¥ μ¶”κ°€ν•λ©΄ μλ™κ³„μ‚°λ¨)</small>
      </div>
    `;
  });

  summaryArea.innerHTML = area;
}

</script>

</body>
</html>
