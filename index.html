<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>TAPE MANAGER</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- í°íŠ¸ -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css" />

  <style>
    * {
      box-sizing: border-box;
      font-family: "Pretendard Variable", sans-serif;
    }
    body {
      margin: 0;
      background: #f7f8ff;
      padding: 10px;
    }

    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    .app-title {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: 1px;
      color: #2c2f48;
    }

    /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
    .nav {
      display: flex;
      gap: 8px;
      margin-bottom: 15px;
    }
    .nav button {
      padding: 7px 10px;
      border-radius: 10px;
      border: none;
      background: #e8eaff;
      color: #333;
      font-size: 13px;
      cursor: pointer;
    }
    .nav button.active {
      background: #647aff;
      color: #fff;
    }

    /* í˜ì´ì§€ */
    .page { display: none; }
    .page.active { display: block; }

    /* ì¹´ë“œ */
    .card {
      background: #fff;
      border-radius: 15px;
      padding: 12px;
      margin-bottom: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      border: 1px solid #e7e9ff;
    }

    /* ì…ë ¥í¼ */
    .form-row {
      display: flex;
      flex-direction: column;
      margin-bottom: 8px;
    }
    .form-row label {
      font-size: 12px;
      margin-bottom: 4px;
      color: #555;
    }
    .form-row input,
    .form-row select {
      padding: 7px 10px;
      border-radius: 10px;
      border: 1px solid #ccd0ff;
      background: #fbfbff;
      font-size: 13px;
    }

    .btn {
      padding: 7px 12px;
      border-radius: 10px;
      border: none;
      font-size: 13px;
      cursor: pointer;
      margin-top: 8px;
    }
    .btn-primary {
      background: #6a7aff;
      color: white;
      box-shadow: 0 4px 10px rgba(100,120,255,0.35);
    }
    .btn-danger {
      background: #ff6b7a;
      color: white;
    }

    .small-btn {
      padding: 4px 8px;
      border-radius: 7px;
      font-size: 12px;
      border: none;
      background: #e0e3ff;
      cursor: pointer;
    }

    .small-input {
      padding: 4px 8px;
      font-size: 12px;
      border-radius: 7px;
      border: 1px solid #d7d9ff;
      width: 70px;
    }

    /* í† ìŠ¤íŠ¸ */
    #toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translate(-50%, 40px);
      background: rgba(20,20,30,0.85);
      color: #fff;
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 13px;
      opacity: 0;
      transition: 0.25s;
      z-index: 999;
    }
    #toast.show {
      opacity: 1;
      transform: translate(-50%,0);
    }
  </style>
</head>

<body>

  <div class="app-header">
    <div class="app-title">ğŸ“¦ TAPE MANAGER</div>
  </div>

  <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
  <div class="nav">
    <button id="nav-tape" class="active">í…Œì´í”„ ì„¤ì •</button>
    <button id="nav-stock">ì‘ì—…ì „ ì¬ê³ </button>
    <button id="nav-work">ì‘ì—… ë“±ë¡</button>
    <button id="nav-summary">ì”ëŸ‰</button>
  </div>

  <!-- PAGE: í…Œì´í”„ ì„¤ì • -->
  <div class="page active" id="page-tape">
    <div class="card">
      <div class="form-row">
        <label>í…Œì´í”„ëª…</label>
        <input id="t-name" placeholder="ì˜ˆ: 25*6000" />
      </div>
      <div class="form-row">
        <label>EA(ê°œìˆ˜)/1ì¥ë‹¹</label>
        <input id="t-ea" type="number" placeholder="ì˜ˆ: 6" />
      </div>
      <div class="form-row">
        <label>ì¶œì²˜</label>
        <select id="t-src">
          <option value="ê°€ê³µì‹¤">ê°€ê³µì‹¤</option>
          <option value="íƒœì„±">íƒœì„±</option>
        </select>
      </div>
      <button class="btn btn-primary" onclick="addTape()">ì¶”ê°€</button>
    </div>

    <div id="tape-list"></div>
  </div>

  <!-- PAGE: ì‘ì—…ì „ ì¬ê³  -->
  <div class="page" id="page-stock">
    <div class="card">
      <div class="form-row">
        <label>ì œí’ˆëª…</label>
        <input id="s-prod" list="prod-list" placeholder="ìë™ì™„ì„±" />
      </div>
      <div class="form-row">
        <label>EA(ìˆ˜ëŸ‰)</label>
        <input id="s-ea" type="number" />
      </div>
      <div class="form-row">
        <label>ë©”ëª¨</label>
        <input id="s-memo" />
      </div>
      <button class="btn btn-primary" onclick="addStock()">ì¶”ê°€</button>
    </div>

    <div id="stock-list"></div>
  </div>

  <!-- ìë™ì™„ì„± -->
  <datalist id="prod-list"></datalist>

  <!-- PAGE: ì‘ì—… ë“±ë¡ -->
  <div class="page" id="page-work">
    <div class="card">
      <div class="form-row">
        <label>ì‘ì—… ì œí’ˆ</label>
        <input id="work-prod" list="prod-list" />
      </div>

      <div class="form-row">
        <label>í…Œì´í”„</label>
        <select id="work-tape"></select>
      </div>

      <div class="form-row">
        <label>í…Œì´í”„ ì¥ìˆ˜</label>
        <input id="work-sheet" type="number" />
      </div>

      <div class="form-row">
        <label>EA ìë™ ê³„ì‚°</label>
        <input id="work-ea" type="number" />
      </div>

      <div class="form-row">
        <label>ë¶ˆëŸ‰</label>
        <input id="work-def" type="number" />
      </div>

      <div class="form-row">
        <label>LOT</label>
        <input id="work-lot" placeholder="LOT ì…ë ¥" />
      </div>

      <div class="form-row">
        <label>ë‚©í’ˆì²˜</label>
        <select id="work-dest">
          <option value="ê°€ê³µì‹¤">ê°€ê³µì‹¤</option>
          <option value="íƒœì„±">íƒœì„±</option>
        </select>
      </div>

      <button class="btn btn-primary" onclick="addWork()">ë“±ë¡</button>
    </div>

    <div id="work-list"></div>
  </div>

  <!-- PAGE: ì”ëŸ‰ -->
  <div class="page" id="page-summary">
    <div class="card">
      <h3 style="margin-top:0;">ğŸ“Œ í…Œì´í”„ ì”ëŸ‰</h3>
    </div>

    <div id="sum-list"></div>
  </div>

  <!-- TOAST -->
  <div id="toast"></div>

<script>

/* =========================================================
   (PART 1) â€” ë°ì´í„° ì €ì¥/ë¡œë“œ + ê¸°ë³¸ êµ¬ì¡°
========================================================= */

function save(k,v){localStorage.setItem(k,JSON.stringify(v));}
function load(k,def){return JSON.parse(localStorage.getItem(k)||JSON.stringify(def));}

let tapeSettings = load("tapeSettings",[]);
let productNames = load("productNames",[]);
let stockList = load("stockList",[]);
let workList = load("workList",[]);
let tapeArrivals = load("tapeArrivals",[]);
let manualRemain = load("manualRemain",{});

function toast(t){
  const el=document.getElementById("toast");
  el.textContent=t;
  el.classList.add("show");
  setTimeout(()=>el.classList.remove("show"),1400);
}

/* í˜ì´ì§€ ì „í™˜ */
function openPage(id){
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.getElementById("page-"+id).classList.add("active");
  document.querySelectorAll(".nav button").forEach(b=>b.classList.remove("active"));
  document.getElementById("nav-"+id).classList.add("active");

  if(id==="summary") renderSummary();
}

/* =========================================================
   (PART 2-1) â€” í…Œì´í”„ ì„¤ì •
========================================================= */

function renderTape(){
  const box=document.getElementById("tape-list");
  box.innerHTML="";

  let html="";
  tapeSettings.forEach((t,i)=>{
    html+=`
      <div class="card">
        <div><b>${t.name}</b> â€” 1ì¥ë‹¹ ${t.ea}EA (${t.src})</div>
        <button class="small-btn" onclick="delTape(${i})">ì‚­ì œ</button>
      </div>`;
  });
  box.innerHTML=html;

  /* ì‘ì—… íƒ­ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸ */
  const sel=document.getElementById("work-tape");
  sel.innerHTML="";
  tapeSettings.forEach(t=>{
    sel.innerHTML+=`<option value="${t.name}">${t.name}</option>`;
  });
}

function addTape(){
  const name=document.getElementById("t-name").value.trim();
  const ea=Number(document.getElementById("t-ea").value);
  const src=document.getElementById("t-src").value;

  if(!name||!ea) return toast("í…Œì´í”„ëª…/EA ì…ë ¥!");

  tapeSettings.push({name,ea,src});
  save("tapeSettings",tapeSettings);

  document.getElementById("t-name").value="";
  document.getElementById("t-ea").value="";

  renderTape();
  toast("ì¶”ê°€ë¨!");
}

function delTape(i){
  tapeSettings.splice(i,1);
  save("tapeSettings",tapeSettings);
  renderTape();
}

/* =========================================================
   (PART 2-2) â€” ì‘ì—…ì „ ì¬ê³ 
========================================================= */

function renderProductNames(){
  const dl=document.getElementById("prod-list");
  dl.innerHTML="";
  productNames.forEach(p=>{
    dl.innerHTML+=`<option value="${p}"></option>`;
  });
}

function addStock(){
  const prod=document.getElementById("s-prod").value.trim();
  const ea=Number(document.getElementById("s-ea").value);
  const memo=document.getElementById("s-memo").value.trim();
  const date=new Date().toISOString().slice(0,10);

  if(!prod||!ea) return toast("ì œí’ˆëª…/EA ì…ë ¥!");

  if(!productNames.includes(prod)){
    productNames.push(prod);
    save("productNames",productNames);
    renderProductNames();
  }

  stockList.push({prod,ea,memo,date});
  save("stockList",stockList);

  document.getElementById("s-prod").value="";
  document.getElementById("s-ea").value="";
  document.getElementById("s-memo").value="";

  renderStock();
}

function renderStock(){
  const box=document.getElementById("stock-list");
  box.innerHTML="";

  stockList.forEach((s,i)=>{
    box.innerHTML+=`
      <div class="card">
        <b>${s.prod}</b> â€” ${s.ea}EA<br>
        (${s.date})
        <div style="margin-top:6px;">
          <button class="small-btn" onclick="delStock(${i})">ì‚­ì œ</button>
        </div>
      </div>`;
  });
}

function delStock(i){
  stockList.splice(i,1);
  save("stockList",stockList);
  renderStock();
}

/* =========================================================
   (PART 2-3) â€” ì‘ì—… ë“±ë¡
========================================================= */

/* EA â†” ì¥ìˆ˜ ìë™ ê³„ì‚° */
document.getElementById("work-sheet").addEventListener("input",()=>{
  const tapeName=document.getElementById("work-tape").value;
  const tape=tapeSettings.find(t=>t.name===tapeName);
  if(!tape) return;
  const sheet=Number(document.getElementById("work-sheet").value);
  document.getElementById("work-ea").value=sheet*tape.ea;
});
document.getElementById("work-ea").addEventListener("input",()=>{
  const tapeName=document.getElementById("work-tape").value;
  const tape=tapeSettings.find(t=>t.name===tapeName);
  if(!tape) return;
  const ea=Number(document.getElementById("work-ea").value);
  document.getElementById("work-sheet").value=Math.ceil(ea/tape.ea);
});

function addWork(){
  const prod=document.getElementById("work-prod").value.trim();
  const tape=document.getElementById("work-tape").value;
  const sheet=Number(document.getElementById("work-sheet").value);
  const ea=Number(document.getElementById("work-ea").value);
  const def=Number(document.getElementById("work-def").value);
  const lot=document.getElementById("work-lot").value.trim();
  const dest=document.getElementById("work-dest").value;
  const date=new Date().toISOString().slice(0,10);

  if(!prod||!tape||!sheet) return toast("í•„ìˆ˜ê°’ ëˆ„ë½!");

  if(!productNames.includes(prod)){
    productNames.push(prod);
    save("productNames",productNames);
    renderProductNames();
  }

  workList.push({prod,tape,sheet,ea,def,lot,dest,date});
  save("workList",workList);

  document.getElementById("work-prod").value="";
  document.getElementById("work-sheet").value="";
  document.getElementById("work-ea").value="";
  document.getElementById("work-def").value="";
  document.getElementById("work-lot").value="";

  renderWork();
  toast("ì‘ì—… ë“±ë¡ë¨!");
}

function renderWork(){
  const box=document.getElementById("work-list");
  box.innerHTML="";

  workList.slice().reverse().forEach((w,i)=>{
    box.innerHTML+=`
      <div class="card">
        <b>${w.prod}</b><br>
        í…Œì´í”„: ${w.tape}<br>
        ì¥ìˆ˜: ${w.sheet}ì¥ / EA ${w.ea}<br>
        ë¶ˆëŸ‰: ${w.def}ì¥ / LOT ${w.lot}<br>
        ë‚©í’ˆì²˜: ${w.dest}<br>
        (${w.date})
      </div>`;
  });
}

/* =========================================================
   (PART 2-4) â€” ì”ëŸ‰ ê³„ì‚°
========================================================= */

function calcRemain(){
  const remain={};

  // 1) ì…ê³ 
  tapeArrivals.forEach(a=>{
    if(!remain[a.tape]) remain[a.tape]=0;
    remain[a.tape]+=a.qty;
  });

  // 2) ì‘ì—… ì‚¬ìš©
  workList.forEach(w=>{
    if(!remain[w.tape]) remain[w.tape]=0;
    remain[w.tape]-=(w.sheet+w.def);
  });

  // 3) ìˆ˜ë™ ìˆ˜ì • ë®ì–´ì“°ê¸°
  for(let key in manualRemain){
    remain[key]=manualRemain[key];
  }

  return remain;
}

function renderSummary(){
  const box=document.getElementById("sum-list");
  box.innerHTML="";

  const remain=calcRemain();

  Object.keys(remain).forEach(t=>{
    box.innerHTML+=`
      <div class="card">
        <b>${t}</b> â€” ì”ëŸ‰: ${remain[t]}ì¥
        <div style="margin-top:6px;">
          <input id="manual-${t}" type="number" class="small-input" placeholder="ìˆ˜ì •â€¦" />
          <button class="small-btn" onclick="saveManualRemain('${t}')">ì ìš©</button>
        </div>
      </div>`;
  });
}

function saveManualRemain(tape){
  const v=Number(document.getElementById(`manual-${tape}`).value);
  if(isNaN(v)) return toast("ìˆ«ì ì…ë ¥!");

  manualRemain[tape]=v;
  save("manualRemain",manualRemain);

  toast("ìˆ˜ì •ë¨!");
  renderSummary();
}

/* ì´ˆê¸° ë Œë”ë§ */
renderTape();
renderProductNames();
renderStock();
renderWork();
openPage("tape");

</script>

</body>
</html>
