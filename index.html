<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Tape Flow</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg-main-light: #f3f6ff;
      --bg-card-light: #ffffff;
      --bg-accent-light: linear-gradient(135deg, #a8c5ff, #4f7dff);
      --text-main-light: #111827;
      --text-sub-light: #6b7280;
      --border-light: #e5e7eb;

      --bg-main-dark: #050816;
      --bg-card-dark: #111827;
      --bg-accent-dark: radial-gradient(circle at top left, #4f7dff, #0f172a);
      --text-main-dark: #e5e7ff;
      --text-sub-dark: #9ca3af;
      --border-dark: #1f2933;

      --primary: #4f7dff;
      --primary-soft: #e0ebff;
      --danger: #f97373;
      --radius-lg: 18px;
      --radius-md: 12px;
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo",
        "Noto Sans KR", sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      background: var(--bg-main-light);
      color: var(--text-main-light);
      -webkit-font-smoothing: antialiased;
    }

    body.dark {
      background: var(--bg-main-dark);
      color: var(--text-main-dark);
    }

    .app {
      max-width: 960px;
      margin: 0 auto;
      padding: 16px 14px 32px;
    }

    header.app-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .logo-box {
      width: 44px;
      height: 44px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-accent-light);
      box-shadow: 0 10px 25px rgba(79, 125, 255, 0.35);
    }

    body.dark .logo-box {
      background: var(--bg-accent-dark);
      box-shadow: 0 16px 40px rgba(15, 23, 42, 0.9);
    }

    .logo-box span {
      font-size: 26px;
    }

    header .title-wrap h1 {
      margin: 0;
      font-size: 22px;
      letter-spacing: 0.06em;
      font-weight: 800;
    }

    header .title-wrap p {
      margin: 4px 0 0;
      font-size: 12px;
      color: var(--text-sub-light);
    }

    body.dark header .title-wrap p {
      color: var(--text-sub-dark);
    }

    /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
    .tab-bar {
      display: flex;
      overflow-x: auto;
      gap: 8px;
      padding: 4px 2px 10px;
      margin-bottom: 10px;
      scrollbar-width: none;
    }

    .tab-bar::-webkit-scrollbar {
      display: none;
    }

    .tab-btn {
      flex: 0 0 auto;
      border: none;
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 13px;
      background: transparent;
      color: var(--text-sub-light);
      border: 1px solid transparent;
      transition: all 0.16s ease;
      white-space: nowrap;
    }

    body.dark .tab-btn {
      color: var(--text-sub-dark);
    }

    .tab-btn.active {
      background: var(--primary);
      color: white;
      box-shadow: 0 8px 22px rgba(79, 125, 255, 0.55);
    }

    .tab-btn:not(.active):hover {
      background: rgba(79, 125, 255, 0.07);
      border-color: rgba(79, 125, 255, 0.2);
    }

    /* ì¹´ë“œ & ì„¹ì…˜ */
    .tab-panel {
      display: none;
    }
    .tab-panel.active {
      display: block;
    }

    .card {
      background: var(--bg-card-light);
      border-radius: var(--radius-lg);
      padding: 16px 14px 18px;
      box-shadow: 0 14px 35px rgba(148, 163, 184, 0.25);
      margin-bottom: 16px;
    }

    body.dark .card {
      background: var(--bg-card-dark);
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.9);
      border: 1px solid var(--border-dark);
    }

    .card h2 {
      margin: 0 0 6px;
      font-size: 17px;
    }

    .card .sub {
      font-size: 12px;
      color: var(--text-sub-light);
      margin-bottom: 10px;
    }
    body.dark .card .sub {
      color: var(--text-sub-dark);
    }

    label {
      display: block;
      font-size: 13px;
      margin: 10px 0 4px;
    }

    input, select {
      width: 100%;
      padding: 10px 11px;
      border-radius: 10px;
      border: 1px solid var(--border-light);
      background: #f9fafb;
      font-size: 14px;
    }

    body.dark input,
    body.dark select {
      border-color: var(--border-dark);
      background: #020617;
      color: var(--text-main-dark);
    }

    input::placeholder {
      color: #c4c4d0;
    }
    body.dark input::placeholder {
      color: #6b7280;
    }

    .inline-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .inline-row > div {
      flex: 1 1 120px;
    }

    .btn-row {
      margin-top: 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .btn-primary,
    .btn-outline,
    .btn-danger {
      border-radius: 999px;
      border: none;
      padding: 10px 18px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
      box-shadow: 0 10px 26px rgba(79, 125, 255, 0.5);
    }
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 32px rgba(79, 125, 255, 0.7);
    }

    .btn-outline {
      background: transparent;
      color: var(--primary);
      border: 1px solid rgba(79, 125, 255, 0.35);
      background-image: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(79, 125, 255, 0.08));
    }
    body.dark .btn-outline {
      color: #e5edff;
      border-color: rgba(148, 163, 255, 0.65);
    }
    .btn-outline:hover {
      background: rgba(79, 125, 255, 0.12);
    }

    .btn-danger {
      background: var(--danger);
      color: white;
      box-shadow: 0 10px 26px rgba(248, 113, 113, 0.4);
    }
    .btn-danger:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 32px rgba(248, 113, 113, 0.7);
    }

    .helper {
      font-size: 12px;
      color: var(--text-sub-light);
      margin-top: 4px;
    }
    body.dark .helper {
      color: var(--text-sub-dark);
    }

    /* í…Œì´ë¸” */
    .table-wrapper {
      margin-top: 10px;
      border-radius: var(--radius-md);
      overflow-x: auto;
      border: 1px solid var(--border-light);
      background: white;
    }
    body.dark .table-wrapper {
      border-color: var(--border-dark);
      background: #020617;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      min-width: 520px;
      font-size: 12px;
    }
    th, td {
      padding: 7px 8px;
      text-align: left;
      border-bottom: 1px solid rgba(148, 163, 184, 0.25);
      white-space: nowrap;
    }
    th {
      background: #eef2ff;
      font-weight: 600;
    }
    body.dark th {
      background: #020617;
      color: #e5e7ff;
    }

    tr:last-child td {
      border-bottom: none;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: var(--primary-soft);
      color: var(--primary);
    }
    body.dark .pill {
      background: rgba(30, 64, 175, 0.7);
      color: #e5edff;
    }

    .badge {
      display: inline-block;
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.2);
    }

    .section-label {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    /* ì¼ë³„ ì¡°íšŒ ë‚ ì§œ ë°” */
    .date-nav {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .date-display {
      padding: 6px 14px;
      border-radius: 999px;
      background: rgba(79, 125, 255, 0.08);
      font-size: 13px;
    }
    body.dark .date-display {
      background: rgba(15, 23, 42, 0.9);
    }

    .date-btn {
      border-radius: 999px;
      border: none;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(148, 163, 184, 0.25);
      cursor: pointer;
    }
    body.dark .date-btn {
      background: rgba(30, 64, 175, 0.8);
      color: #e5edff;
    }

    /* í† ê¸€ ìŠ¤ìœ„ì¹˜ ëŠë‚Œ */
    .pill-toggle {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      font-size: 12px;
      gap: 6px;
    }

    .pill-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--primary);
    }

    body.dark .pill-toggle {
      border-color: rgba(148, 163, 255, 0.7);
    }

    .mt-4 { margin-top: 14px; }
    .mt-2 { margin-top: 8px; }

    .align-right {
      text-align: right;
    }
  </style>
</head>
<body>
<div class="app">
  <header class="app-header">
    <div class="logo-box"><span>ğŸ“¦</span></div>
    <div class="title-wrap">
      <h1>TAPE FLOW</h1>
      <p>í…Œì´í”„ Â· ì œí’ˆ ì¬ê³  &amp; ì‘ì—… ê¸°ë¡ ê´€ë¦¬</p>
    </div>
  </header>

  <nav class="tab-bar">
    <button class="tab-btn active" data-tab="products">ì œí’ˆ ì¬ê³ </button>
    <button class="tab-btn" data-tab="work">ì‘ì—… ë“±ë¡</button>
    <button class="tab-btn" data-tab="tape-stock">í…Œì´í”„ ì¬ê³ </button>
    <button class="tab-btn" data-tab="daily">ì¼ë³„ ì¡°íšŒ</button>
    <button class="tab-btn" data-tab="tape-settings">í…Œì´í”„ ì„¤ì •</button>
    <button class="tab-btn" data-tab="settings">ì„¤ì •</button>
  </nav>

  <!-- ì œí’ˆ ì¬ê³  -->
  <section id="tab-products" class="tab-panel active">
    <div class="card">
      <h2>ì œí’ˆ ì¬ê³  ë“±ë¡</h2>
      <p class="sub">ì¸ì‡„ì‹¤ì—ì„œ ë‚´ë ¤ì˜¨ ì‘ì—… ì „ ì œí’ˆ ì¬ê³ ë¥¼ ë“±ë¡í•´ìš”. ê°™ì€ ì œí’ˆì´ë¼ë„ ì„¸íŠ¸ë³„ë¡œ ë”°ë¡œ ì…ë ¥í•˜ë©´ ë¼ìš”.</p>

      <label>ì œí’ˆëª…</label>
      <input id="product-name" placeholder="ì˜ˆ: 7125J" />

      <label>ìˆ˜ëŸ‰(EA)</label>
      <input id="product-ea" type="number" placeholder="ì˜ˆ: 2520" />

      <label>ë°œì‹  LOT</label>
      <input id="product-lot" placeholder="ì˜ˆ: LOT123" />

      <label>ì¸ì‡„ì</label>
      <input id="product-printer" placeholder="ì˜ˆ: ê¹€ì£¼í˜„" />

      <div class="btn-row">
        <button class="btn-primary" id="add-product-stock">ì¬ê³  ì¶”ê°€</button>
      </div>

      <div class="helper">
        Â· ê°™ì€ ì œí’ˆì´ ì—¬ëŸ¬ ì„¸íŠ¸ë©´ ì„¸íŠ¸ë§ˆë‹¤ ë”°ë¡œ ì…ë ¥í•´ ì£¼ì„¸ìš”.<br/>
        Â· ì‘ì—… ë“±ë¡ ì‹œ ì—¬ê¸° ì¬ê³ ì—ì„œ ì°¨ê°ë˜ê³  0ì´ ë˜ë©´ ìë™ìœ¼ë¡œ ì‚¬ë¼ì ¸ìš”.
      </div>

      <div class="table-wrapper mt-4" id="product-stock-table-wrapper">
        <table>
          <thead>
          <tr>
            <th>ë‚ ì§œ</th>
            <th>ì œí’ˆëª…</th>
            <th>EA</th>
            <th>ë°œì‹  LOT</th>
            <th>ì¸ì‡„ì</th>
          </tr>
          </thead>
          <tbody id="product-stock-tbody">
          </tbody>
        </table>
      </div>

      <div class="btn-row mt-2">
        <button class="btn-outline" id="download-product-csv">ì œí’ˆ ì¬ê³  CSV ë‹¤ìš´ë¡œë“œ</button>
      </div>
    </div>
  </section>

  <!-- ì‘ì—… ë“±ë¡ -->
  <section id="tab-work" class="tab-panel">
    <div class="card">
      <h2>ì‘ì—… ë“±ë¡</h2>
      <p class="sub">ì–´ë–¤ ì œí’ˆì— ì–´ë–¤ í…Œì´í”„ë¥¼ ëª‡ ì¥ ì‚¬ìš©í–ˆëŠ”ì§€ ê¸°ë¡í•´ìš”. EAì™€ ì¥ìˆ˜ ì¤‘ í•˜ë‚˜ë§Œ ì…ë ¥í•´ë„ ìë™ ê³„ì‚°ë¼ìš”.</p>

      <div class="inline-row">
        <div>
          <label>ì‘ì—… ë‚ ì§œ</label>
          <input id="work-date" type="date" />
        </div>
        <div>
          <label>ì‘ì—… ë°©í–¥</label>
          <select id="work-destination">
            <option value="ê°€ê³µì‹¤">ê°€ê³µì‹¤</option>
            <option value="íƒœì„±">íƒœì„±</option>
            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
          </select>
        </div>
      </div>

      <label>ì œí’ˆëª… (ìë™ì™„ì„±)</label>
      <input id="work-product-name" list="product-name-list" placeholder="ì˜ˆ: 7125J" />
      <datalist id="product-name-list"></datalist>

      <label>ë°œì‹  LOT (ìë™ì™„ì„±)</label>
      <input id="work-lot" list="lot-list" placeholder="ì˜ˆ: LOT123" />
      <datalist id="lot-list"></datalist>

      <label>í…Œì´í”„ ì„ íƒ</label>
      <select id="work-tape">
        <option value="">í…Œì´í”„ ì„ íƒ</option>
      </select>

      <div class="inline-row">
        <div>
          <label>EA ì‚¬ìš©ëŸ‰</label>
          <input id="work-ea" type="number" placeholder="ì˜ˆ: 2520" />
        </div>
        <div>
          <label>í…Œì´í”„ ì‚¬ìš© ì¥ìˆ˜</label>
          <input id="work-sheets" type="number" placeholder="ì˜ˆ: 315" />
        </div>
      </div>

      <label>í…Œì´í”„ ë¶ˆëŸ‰ ì¥ìˆ˜</label>
      <input id="work-defect" type="number" placeholder="ì˜ˆ: 2" />

      <div class="helper">
        Â· EA ë˜ëŠ” ì¥ìˆ˜ ì¤‘ í•˜ë‚˜ë§Œ ì…ë ¥í•˜ë©´, í…Œì´í”„ ì„¤ì •ì˜ EA/ì¥ ê°’ìœ¼ë¡œ ê³„ì‚°í•´ì„œ ë‚˜ë¨¸ì§€ í•œìª½ì´ ìë™ìœ¼ë¡œ ì±„ì›Œì ¸ìš”.<br/>
        Â· í…Œì´í”„ ë¶ˆëŸ‰ì€ ê·¸ëƒ¥ ë²„ë¦° ì¥ìˆ˜ë§Œ ì ìœ¼ë©´ ë¼ìš”.
      </div>

      <div class="btn-row">
        <button class="btn-primary" id="add-work">ì‘ì—… ë“±ë¡</button>
      </div>

      <div class="table-wrapper mt-4">
        <table>
          <thead>
          <tr>
            <th>ë‚ ì§œ</th>
            <th>ì œí’ˆëª…</th>
            <th>LOT</th>
            <th>í…Œì´í”„</th>
            <th>EA</th>
            <th>ì‚¬ìš© ì¥ìˆ˜</th>
            <th>ë¶ˆëŸ‰ ì¥ìˆ˜</th>
            <th>ì‘ì—…ì²˜</th>
          </tr>
          </thead>
          <tbody id="work-tbody"></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- í…Œì´í”„ ì¬ê³  -->
  <section id="tab-tape-stock" class="tab-panel">
    <div class="card">
      <h2>í…Œì´í”„ ì…ê³  &amp; ì¬ê³ </h2>
      <p class="sub">ê°€ê³µì‹¤Â·íƒœì„±ì—ì„œ ì˜¬ë¼ì˜¨ í…Œì´í”„ ì¥ìˆ˜ë¥¼ ë“±ë¡í•˜ê³ , ì „ì²´ ì¬ê³ ë¥¼ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.</p>

      <div class="inline-row">
        <div>
          <label>ì…ê³  ë‚ ì§œ</label>
          <input id="tape-in-date" type="date" />
        </div>
        <div>
          <label>ì…ê³  ì¶œì²˜</label>
          <select id="tape-in-source">
            <option value="ê°€ê³µì‹¤">ê°€ê³µì‹¤</option>
            <option value="íƒœì„±">íƒœì„±</option>
            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
          </select>
        </div>
      </div>

      <label>í…Œì´í”„</label>
      <select id="tape-in-name">
        <option value="">í…Œì´í”„ ì„ íƒ</option>
      </select>

      <label>ì…ê³  ì¥ìˆ˜</label>
      <input id="tape-in-qty" type="number" placeholder="ì˜ˆ: 300" />

      <div class="btn-row">
        <button class="btn-primary" id="add-tape-in">ì…ê³  ì¶”ê°€</button>
      </div>

      <p class="helper">
        í…Œì´í”„ ì”ëŸ‰ì€ ì…ê³ Â·ë¶ˆëŸ‰Â·ì‘ì—… ì‚¬ìš©ëŸ‰, ìˆ˜ê¸° ì¡°ì •ê°’ì„ ëª¨ë‘ ë°˜ì˜í•´ì„œ ìë™ ê³„ì‚°ë¼ìš”.
      </p>

      <div class="mt-4 section-label">í…Œì´í”„ ì¬ê³  í˜„í™©</div>
      <div class="table-wrapper">
        <table>
          <thead>
          <tr>
            <th>í…Œì´í”„ëª…</th>
            <th>EA/ì¥</th>
            <th>ì…ê³  ì¥ìˆ˜</th>
            <th>ì‚¬ìš© ì¥ìˆ˜</th>
            <th>ë¶ˆëŸ‰ ì¥ìˆ˜</th>
            <th>ì¡°ì •</th>
            <th>í˜„ì¬ ì¥ìˆ˜</th>
          </tr>
          </thead>
          <tbody id="tape-stock-tbody"></tbody>
        </table>
      </div>

      <div class="helper mt-2">
        * ì¡°ì •ì€ ê³„ì‚°ê°’ê³¼ ì‹¤ì œ ì”ëŸ‰ì´ ë‹¤ë¥¼ ë•Œ ë§ì¶° ë„£ëŠ” ìš©ë„ì˜ˆìš”. ì¡°ì • ë‚´ì—­ì€ ë³„ë„ë¡œ ì €ì¥ë¼ìš”.
      </div>

      <div class="btn-row mt-2">
        <button class="btn-outline" id="download-tape-csv">í…Œì´í”„ ì¬ê³  CSV</button>
      </div>
    </div>
  </section>

  <!-- ì¼ë³„ ì¡°íšŒ -->
  <section id="tab-daily" class="tab-panel">
    <div class="card">
      <h2>ì¼ë³„ ì¬ê³  &amp; ì‘ì—… ë‚´ì—­</h2>
      <p class="sub">ì›í•˜ëŠ” ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ í…Œì´í”„ ì¬ê³ ì™€ ê·¸ë‚  ì‘ì—… ë‚´ì—­ì„ í•œ ë²ˆì— í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.</p>

      <div class="date-nav">
        <button class="date-btn" id="daily-prev">&lt;</button>
        <div class="date-display" id="daily-date-label"></div>
        <button class="date-btn" id="daily-next">&gt;</button>
      </div>

      <div class="section-label">í•´ë‹¹ ë‚ ì§œ ê¸°ì¤€ í…Œì´í”„ ì¬ê³ </div>
      <div class="table-wrapper">
        <table>
          <thead>
          <tr>
            <th>í…Œì´í”„ëª…</th>
            <th>ì…ê³  ì¥ìˆ˜(ëˆ„ì )</th>
            <th>ì‚¬ìš© ì¥ìˆ˜(ëˆ„ì )</th>
            <th>ë¶ˆëŸ‰ ì¥ìˆ˜(ëˆ„ì )</th>
            <th>ì¡°ì •(ëˆ„ì )</th>
            <th>ì”ëŸ‰</th>
          </tr>
          </thead>
          <tbody id="daily-tape-tbody"></tbody>
        </table>
      </div>

      <div class="section-label mt-4">í•´ë‹¹ ë‚ ì§œ ì‘ì—… ë‚´ì—­</div>
      <div class="table-wrapper">
        <table>
          <thead>
          <tr>
            <th>ì‹œê°„ìˆœ</th>
            <th>ì œí’ˆëª…</th>
            <th>LOT</th>
            <th>í…Œì´í”„</th>
            <th>EA</th>
            <th>ì‚¬ìš© ì¥ìˆ˜</th>
            <th>ë¶ˆëŸ‰</th>
            <th>ì‘ì—…ì²˜</th>
          </tr>
          </thead>
          <tbody id="daily-work-tbody"></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- í…Œì´í”„ ì„¤ì • -->
  <section id="tab-tape-settings" class="tab-panel">
    <div class="card">
      <h2>í…Œì´í”„ ê¸°ë³¸ ì •ë³´</h2>
      <p class="sub">í…Œì´í”„ ì¢…ë¥˜ë³„ë¡œ EA/ì¥ ê°’ì„ ë“±ë¡í•´ ë‘ë©´ ì‘ì—… ë“±ë¡ ì‹œ ìë™ ê³„ì‚°ì— ì‚¬ìš©ë¼ìš”.</p>

      <label>í…Œì´í”„ëª…</label>
      <input id="tape-name" placeholder="ì˜ˆ: 6855, 6491" />

      <label>EA(ì œí’ˆ ìˆ˜ëŸ‰) / 1ì¥ë‹¹</label>
      <input id="tape-ea-per-sheet" type="number" placeholder="ì˜ˆ: 6" />

      <label>ê¸°ë³¸ ì¶œì²˜</label>
      <select id="tape-source">
        <option value="ê°€ê³µì‹¤">ê°€ê³µì‹¤</option>
        <option value="íƒœì„±">íƒœì„±</option>
        <option value="ê³µí†µ">ê³µí†µ</option>
        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
      </select>

      <div class="btn-row">
        <button class="btn-primary" id="add-tape">í…Œì´í”„ ì¶”ê°€</button>
      </div>

      <div class="table-wrapper mt-4">
        <table>
          <thead>
          <tr>
            <th>í…Œì´í”„ëª…</th>
            <th>EA/ì¥</th>
            <th>ì¶œì²˜</th>
          </tr>
          </thead>
          <tbody id="tape-settings-tbody"></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- ì„¤ì • -->
  <section id="tab-settings" class="tab-panel">
    <div class="card">
      <h2>í…Œë§ˆ Â· í™”ë©´ ì„¤ì •</h2>
      <p class="sub">ë¼ì´íŠ¸ / ë‹¤í¬ í…Œë§ˆë¥¼ ë³€ê²½í•  ìˆ˜ ìˆì–´ìš”.</p>

      <div class="inline-row">
        <div>
          <div class="pill-toggle">
            <div class="pill-dot"></div>
            <span id="theme-status-text">í˜„ì¬: ë¼ì´íŠ¸ ëª¨ë“œ</span>
          </div>
        </div>
        <div class="btn-row">
          <button class="btn-outline" id="toggle-theme">ë¼ì´íŠ¸ / ë‹¤í¬ ì „í™˜</button>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>ë¹„ë°€ë²ˆí˜¸ ì„¤ì •</h2>
      <p class="sub">ë‹¤ë¥¸ ì‚¬ëŒì´ í•¨ë¶€ë¡œ ìˆ˜ì • ëª» í•˜ê²Œ ê°„ë‹¨í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ê±¸ ìˆ˜ ìˆì–´ìš”. (ê¸°ê¸° í•œ ëŒ€ ê¸°ì¤€)</p>

      <label>í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ (ìˆì„ ê²½ìš°)</label>
      <input id="current-pin" type="password" placeholder="ì—†ìœ¼ë©´ ë¹„ì›Œë‘ê¸°" />

      <label>ìƒˆ ë¹„ë°€ë²ˆí˜¸ (ìˆ«ì ëª‡ ìë¦¬ë“  ê°€ëŠ¥)</label>
      <input id="new-pin" type="password" placeholder="ì˜ˆ: 1234" />

      <div class="btn-row">
        <button class="btn-primary" id="set-pin">ë¹„ë°€ë²ˆí˜¸ ì„¤ì • / ë³€ê²½</button>
        <button class="btn-outline" id="clear-pin">ë¹„ë°€ë²ˆí˜¸ í•´ì œ</button>
      </div>

      <p class="helper">
        Â· ë¹„ë°€ë²ˆí˜¸ëŠ” ì´ ê¸°ê¸°ì—ë§Œ ì €ì¥ë¼ìš”. ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠìœ¼ë©´ ë°ì´í„°ëŠ” ë‚¨ì•„ìˆì§€ë§Œ ì ê¸ˆì„ í•´ì œí•˜ê¸° ì–´ë ¤ìš¸ ìˆ˜ ìˆìœ¼ë‹ˆ ì¡°ì‹¬í•´ ì£¼ì„¸ìš”.
      </p>
    </div>
  </section>
</div>

<script>
  // ======== ìƒíƒœ & ì €ì¥ =========
  const STORAGE_KEY = 'tape_flow_v3';

  let state = {
    tapes: [],            // {name, eaPerSheet, source}
    tapeInRecords: [],    // {id, date, tapeName, qty, source}
    tapeAdjustments: [],  // {id, date, tapeName, delta}
    productStocks: [],    // {id, date, productName, ea, lot, printer}
    workRecords: [],      // {id, date, productName, lot, tapeName, eaUsed, sheetsUsed, defectSheets, destination}
    settings: {
      theme: 'light',
      pin: ''
    }
  };

  function loadState() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw) {
        const parsed = JSON.parse(raw);
        state = Object.assign(state, parsed);
      }
    } catch (e) {
      console.error('loadState error', e);
    }
  }

  function saveState() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }

  function uid() {
    return Date.now().toString(36) + Math.random().toString(36).substring(2, 8);
  }

  loadState();

  // ======== ê³µí†µ ìœ í‹¸ =========
  function todayStr() {
    const d = new Date();
    return d.toISOString().slice(0, 10);
  }

  function formatDateLabel(iso) {
    const [y, m, d] = iso.split('-');
    return `${y}ë…„ ${m}ì›” ${d}ì¼`;
  }

  function withinDate(dateStr, cutoffStr) {
    if (!cutoffStr) return true;
    return dateStr <= cutoffStr;
  }

  // ======== í…Œë§ˆ ì ìš© =========
  const themeStatusText = document.getElementById('theme-status-text');
  function applyTheme() {
    if (state.settings.theme === 'dark') {
      document.body.classList.add('dark');
      themeStatusText.textContent = 'í˜„ì¬: ë‹¤í¬ ëª¨ë“œ';
    } else {
      document.body.classList.remove('dark');
      themeStatusText.textContent = 'í˜„ì¬: ë¼ì´íŠ¸ ëª¨ë“œ';
    }
  }
  applyTheme();

  document.getElementById('toggle-theme').addEventListener('click', () => {
    state.settings.theme = state.settings.theme === 'dark' ? 'light' : 'dark';
    saveState();
    applyTheme();
  });

  // ======== íƒ­ ì „í™˜ =========
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const tab = btn.dataset.tab;
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById('tab-' + tab).classList.add('active');
    });
  });

  // ======== CSV ë‹¤ìš´ë¡œë“œ =========
  function downloadCSV(filename, headers, rows) {
    const csvRows = [];
    csvRows.push(headers.join(','));
    rows.forEach(r => {
      csvRows.push(r.map(v => `"${String(v ?? '').replace(/"/g, '""')}"`).join(','));
    });
    const blob = new Blob([csvRows.join('\n')], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    a.click();
    URL.revokeObjectURL(url);
  }

  // ======== í…Œì´í”„ ì„¤ì • =========
  const tapeNameInput = document.getElementById('tape-name');
  const tapeEaInput = document.getElementById('tape-ea-per-sheet');
  const tapeSourceInput = document.getElementById('tape-source');
  const tapeSettingsTbody = document.getElementById('tape-settings-tbody');
  const workTapeSelect = document.getElementById('work-tape');
  const tapeInNameSelect = document.getElementById('tape-in-name');

  function refreshTapeSelects() {
    [workTapeSelect, tapeInNameSelect].forEach(sel => {
      const current = sel.value;
      sel.innerHTML = '<option value="">í…Œì´í”„ ì„ íƒ</option>';
      state.tapes.forEach(t => {
        const opt = document.createElement('option');
        opt.value = t.name;
        opt.textContent = t.name;
        sel.appendChild(opt);
      });
      if (current) sel.value = current;
    });
  }

  function renderTapeSettings() {
    tapeSettingsTbody.innerHTML = '';
    state.tapes.forEach(t => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${t.name}</td>
        <td>${t.eaPerSheet}</td>
        <td>${t.source}</td>
      `;
      tapeSettingsTbody.appendChild(tr);
    });
    refreshTapeSelects();
  }

  document.getElementById('add-tape').addEventListener('click', () => {
    const name = tapeNameInput.value.trim();
    const ea = Number(tapeEaInput.value);
    const source = tapeSourceInput.value;
    if (!name || !ea) {
      alert('í…Œì´í”„ëª…ê³¼ EA/ì¥ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
      return;
    }
    const idx = state.tapes.findIndex(t => t.name === name);
    const entry = { name, eaPerSheet: ea, source };
    if (idx >= 0) {
      state.tapes[idx] = entry;
    } else {
      state.tapes.push(entry);
    }
    tapeNameInput.value = '';
    tapeEaInput.value = '';
    saveState();
    renderTapeSettings();
  });

  // ======== ì œí’ˆ ì¬ê³  =========
  const productNameInput = document.getElementById('product-name');
  const productEaInput = document.getElementById('product-ea');
  const productLotInput = document.getElementById('product-lot');
  const productPrinterInput = document.getElementById('product-printer');
  const productStockTbody = document.getElementById('product-stock-tbody');
  const productNameList = document.getElementById('product-name-list');
  const lotList = document.getElementById('lot-list');

  function renderProductStock() {
    productStockTbody.innerHTML = '';
    state.productStocks.forEach(ps => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${ps.date}</td>
        <td>${ps.productName}</td>
        <td>${ps.ea}</td>
        <td>${ps.lot}</td>
        <td>${ps.printer}</td>
      `;
      productStockTbody.appendChild(tr);
    });

    // datalist ìë™ì™„ì„±ìš©
    const productNames = [...new Set(state.productStocks.map(p => p.productName))];
    productNameList.innerHTML = '';
    productNames.forEach(n => {
      const opt = document.createElement('option');
      opt.value = n;
      productNameList.appendChild(opt);
    });

    const lots = [...new Set(state.productStocks.map(p => p.lot))];
    lotList.innerHTML = '';
    lots.forEach(l => {
      const opt = document.createElement('option');
      opt.value = l;
      lotList.appendChild(opt);
    });
  }

  document.getElementById('add-product-stock').addEventListener('click', () => {
    const name = productNameInput.value.trim();
    const ea = Number(productEaInput.value);
    const lot = productLotInput.value.trim();
    const printer = productPrinterInput.value.trim();
    if (!name || !ea || !lot || !printer) {
      alert('ì œí’ˆëª…, ìˆ˜ëŸ‰, LOT, ì¸ì‡„ìë¥¼ ëª¨ë‘ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
      return;
    }
    state.productStocks.push({
      id: uid(),
      date: todayStr(),
      productName: name,
      ea,
      lot,
      printer
    });
    productNameInput.value = '';
    productEaInput.value = '';
    productLotInput.value = '';
    productPrinterInput.value = '';
    saveState();
    renderProductStock();
  });

  document.getElementById('download-product-csv').addEventListener('click', () => {
    const rows = state.productStocks.map(p => [
      p.date,
      p.productName,
      p.ea,
      p.lot,
      p.printer
    ]);
    downloadCSV('product_stock.csv', ['ë‚ ì§œ', 'ì œí’ˆëª…', 'EA', 'ë°œì‹ LOT', 'ì¸ì‡„ì'], rows);
  });

  // ======== ì‘ì—… ë“±ë¡ & ì œí’ˆ ì¬ê³  ì°¨ê° =========
  const workDateInput = document.getElementById('work-date');
  const workProductNameInput = document.getElementById('work-product-name');
  const workLotInput = document.getElementById('work-lot');
  const workEaInput = document.getElementById('work-ea');
  const workSheetsInput = document.getElementById('work-sheets');
  const workDefectInput = document.getElementById('work-defect');
  const workDestinationSelect = document.getElementById('work-destination');
  const workTbody = document.getElementById('work-tbody');

  workDateInput.value = todayStr();
  document.getElementById('tape-in-date').value = todayStr();

  function renderWorkTable() {
    workTbody.innerHTML = '';
    state.workRecords
      .slice()
      .sort((a, b) => a.date.localeCompare(b.date))
      .forEach(w => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${w.date}</td>
          <td>${w.productName}</td>
          <td>${w.lot}</td>
          <td>${w.tapeName}</td>
          <td>${w.eaUsed}</td>
          <td>${w.sheetsUsed}</td>
          <td>${w.defectSheets}</td>
          <td>${w.destination}</td>
        `;
        workTbody.appendChild(tr);
      });
  }

  // í…Œì´í”„ ì„¤ì •ì—ì„œ EA/ì¥ ê°€ì ¸ì˜¤ê¸°
  function getEaPerSheet(tapeName) {
    const t = state.tapes.find(t => t.name === tapeName);
    return t ? t.eaPerSheet : 0;
  }

  document.getElementById('add-work').addEventListener('click', () => {
    const date = workDateInput.value || todayStr();
    const productName = workProductNameInput.value.trim();
    const lot = workLotInput.value.trim();
    const tapeName = workTapeSelect.value;
    let ea = Number(workEaInput.value);
    let sheets = Number(workSheetsInput.value);
    const defect = Number(workDefectInput.value || 0);
    const dest = workDestinationSelect.value;

    if (!productName || !lot || !tapeName) {
      alert('ì œí’ˆëª…, LOT, í…Œì´í”„ë¥¼ ëª¨ë‘ ì„ íƒí•´ ì£¼ì„¸ìš”.');
      return;
    }
    const eaPerSheet = getEaPerSheet(tapeName);
    if (!ea && !sheets) {
      alert('EA ë˜ëŠ” í…Œì´í”„ ì¥ìˆ˜ ì¤‘ í•˜ë‚˜ ì´ìƒì€ ì…ë ¥í•´ì•¼ í•´ìš”.');
      return;
    }
    if (!ea) ea = sheets * eaPerSheet;
    if (!sheets) sheets = eaPerSheet ? Math.round(ea / eaPerSheet) : 0;

    // ì œí’ˆ ì¬ê³  ì°¨ê° (ê°™ì€ LOTë¶€í„° ì°¨ê°)
    let remainToUse = ea;
    const stocks = state.productStocks.filter(p => p.productName === productName && p.lot === lot);
    stocks.sort((a, b) => a.date.localeCompare(b.date));
    for (const s of stocks) {
      if (remainToUse <= 0) break;
      const use = Math.min(s.ea, remainToUse);
      s.ea -= use;
      remainToUse -= use;
    }
    // 0 ëœ ì¬ê³  ì‚­ì œ
    state.productStocks = state.productStocks.filter(s => s.ea > 0);

    if (remainToUse > 0) {
      alert('ì£¼ì˜: ì œí’ˆ ì¬ê³ ë³´ë‹¤ ë” ë§ì´ ì‚¬ìš©í–ˆì–´ìš”. ì¬ê³ ë¥¼ í•œ ë²ˆ í™•ì¸í•´ ì£¼ì„¸ìš”.');
    }

    state.workRecords.push({
      id: uid(),
      date,
      productName,
      lot,
      tapeName,
      eaUsed: ea,
      sheetsUsed: sheets,
      defectSheets: defect,
      destination: dest
    });

    workProductNameInput.value = '';
    workLotInput.value = '';
    workEaInput.value = '';
    workSheetsInput.value = '';
    workDefectInput.value = '';

    saveState();
    renderProductStock();
    renderWorkTable();
    renderTapeStock();
    refreshDailyView();
  });

  // ======== í…Œì´í”„ ì…ê³  & ì¬ê³  ê³„ì‚° =========
  const tapeInDateInput = document.getElementById('tape-in-date');
  const tapeInSourceSelect = document.getElementById('tape-in-source');
  const tapeInQtyInput = document.getElementById('tape-in-qty');
  const tapeStockTbody = document.getElementById('tape-stock-tbody');

  document.getElementById('add-tape-in').addEventListener('click', () => {
    const date = tapeInDateInput.value || todayStr();
    const tapeName = tapeInNameSelect.value;
    const source = tapeInSourceSelect.value;
    const qty = Number(tapeInQtyInput.value);
    if (!tapeName || !qty) {
      alert('í…Œì´í”„ì™€ ì…ê³  ì¥ìˆ˜ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
      return;
    }
    state.tapeInRecords.push({
      id: uid(),
      date,
      tapeName,
      qty,
      source
    });
    tapeInQtyInput.value = '';
    saveState();
    renderTapeStock();
    refreshDailyView();
  });

  function computeTapeSummary(uptoDate) {
    const map = new Map(); // tapeName -> stats
    function ensure(tapeName) {
      if (!map.has(tapeName)) {
        const t = state.tapes.find(tt => tt.name === tapeName);
        map.set(tapeName, {
          tapeName,
          eaPerSheet: t ? t.eaPerSheet : 0,
          inQty: 0,
          usedQty: 0,
          defectQty: 0,
          adjust: 0
        });
      }
      return map.get(tapeName);
    }

    state.tapeInRecords.forEach(r => {
      if (withinDate(r.date, uptoDate)) {
        const s = ensure(r.tapeName);
        s.inQty += Number(r.qty);
      }
    });

    state.workRecords.forEach(w => {
      if (withinDate(w.date, uptoDate)) {
        const s = ensure(w.tapeName);
        s.usedQty += Number(w.sheetsUsed);
        s.defectQty += Number(w.defectSheets || 0);
      }
    });

    state.tapeAdjustments.forEach(a => {
      if (withinDate(a.date, uptoDate)) {
        const s = ensure(a.tapeName);
        s.adjust += Number(a.delta);
      }
    });

    // ensure all tapes appear
    state.tapes.forEach(t => ensure(t.name));

    const list = Array.from(map.values());
    list.forEach(s => {
      s.current = s.inQty - s.usedQty - s.defectQty + s.adjust;
    });
    return list;
  }

  function renderTapeStock() {
    const summary = computeTapeSummary(null);
    tapeStockTbody.innerHTML = '';
    summary.forEach(s => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${s.tapeName}</td>
        <td>${s.eaPerSheet}</td>
        <td>${s.inQty}</td>
        <td>${s.usedQty}</td>
        <td>${s.defectQty}</td>
        <td class="align-right"><span class="pill">${s.adjust}</span></td>
        <td>${s.current}</td>
      `;
      tapeStockTbody.appendChild(tr);
    });
  }

  document.getElementById('download-tape-csv').addEventListener('click', () => {
    const summary = computeTapeSummary(null);
    const rows = summary.map(s => [
      s.tapeName,
      s.eaPerSheet,
      s.inQty,
      s.usedQty,
      s.defectQty,
      s.adjust,
      s.current
    ]);
    downloadCSV('tape_stock.csv',
      ['í…Œì´í”„ëª…', 'EA/ì¥', 'ì…ê³  ì¥ìˆ˜', 'ì‚¬ìš© ì¥ìˆ˜', 'ë¶ˆëŸ‰ ì¥ìˆ˜', 'ì¡°ì •', 'í˜„ì¬ ì¥ìˆ˜'],
      rows);
  });

  // ======== ì¼ë³„ ì¡°íšŒ =========
  let dailyDate = todayStr();
  const dailyLabel = document.getElementById('daily-date-label');
  const dailyTapeTbody = document.getElementById('daily-tape-tbody');
  const dailyWorkTbody = document.getElementById('daily-work-tbody');

  function refreshDailyView() {
    dailyLabel.textContent = formatDateLabel(dailyDate);

    const summary = computeTapeSummary(dailyDate);
    dailyTapeTbody.innerHTML = '';
    summary.forEach(s => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${s.tapeName}</td>
        <td>${s.inQty}</td>
        <td>${s.usedQty}</td>
        <td>${s.defectQty}</td>
        <td>${s.adjust}</td>
        <td>${s.current}</td>
      `;
      dailyTapeTbody.appendChild(tr);
    });

    dailyWorkTbody.innerHTML = '';
    state.workRecords
      .filter(w => w.date === dailyDate)
      .sort((a, b) => a.id.localeCompare(b.id))
      .forEach((w, idx) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${idx + 1}</td>
          <td>${w.productName}</td>
          <td>${w.lot}</td>
          <td>${w.tapeName}</td>
          <td>${w.eaUsed}</td>
          <td>${w.sheetsUsed}</td>
          <td>${w.defectSheets}</td>
          <td>${w.destination}</td>
        `;
        dailyWorkTbody.appendChild(tr);
      });
  }

  document.getElementById('daily-prev').addEventListener('click', () => {
    const d = new Date(dailyDate);
    d.setDate(d.getDate() - 1);
    dailyDate = d.toISOString().slice(0, 10);
    refreshDailyView();
  });

  document.getElementById('daily-next').addEventListener('click', () => {
    const d = new Date(dailyDate);
    d.setDate(d.getDate() + 1);
    dailyDate = d.toISOString().slice(0, 10);
    refreshDailyView();
  });

  // ======== ë¹„ë°€ë²ˆí˜¸ ì ê¸ˆ (ê°„ë‹¨ ë²„ì „) =========
  const currentPinInput = document.getElementById('current-pin');
  const newPinInput = document.getElementById('new-pin');

  function checkPinIfNeeded(action) {
    const pin = state.settings.pin;
    if (!pin) {
      action();
      return;
    }
    const entered = prompt('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
    if (entered === pin) {
      action();
    } else {
      alert('ë¹„ë°€ë²ˆí˜¸ê°€ ë§ì§€ ì•Šì•„ìš”.');
    }
  }

  document.getElementById('set-pin').addEventListener('click', () => {
    const current = currentPinInput.value;
    const newPin = newPinInput.value;
    if (state.settings.pin && current !== state.settings.pin) {
      alert('í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ê°€ ë§ì§€ ì•Šì•„ìš”.');
      return;
    }
    state.settings.pin = newPin || '';
    saveState();
    alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì„¤ì •/ë³€ê²½ë˜ì—ˆì–´ìš”.');
    currentPinInput.value = '';
    newPinInput.value = '';
  });

  document.getElementById('clear-pin').addEventListener('click', () => {
    if (!state.settings.pin) {
      alert('í˜„ì¬ ì„¤ì •ëœ ë¹„ë°€ë²ˆí˜¸ê°€ ì—†ì–´ìš”.');
      return;
    }
    const entered = prompt('í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
    if (entered === state.settings.pin) {
      state.settings.pin = '';
      saveState();
      alert('ë¹„ë°€ë²ˆí˜¸ê°€ í•´ì œë˜ì—ˆì–´ìš”.');
    } else {
      alert('ë¹„ë°€ë²ˆí˜¸ê°€ ë§ì§€ ì•Šì•„ìš”.');
    }
  });

  // ======== ì´ˆê¸° ë Œë” =========
  renderTapeSettings();
  renderProductStock();
  renderWorkTable();
  renderTapeStock();
  refreshDailyView();
</script>
</body>
  </html>
